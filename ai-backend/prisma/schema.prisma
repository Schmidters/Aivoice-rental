// prisma/schema.prisma
// Version: Ava V6 â€” DB-first (no Redis)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Lead {
  id         Int             @id @default(autoincrement())
  phone      String          @unique
  name       String?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  messages   Message[]
  bookings   Booking[]
  properties LeadProperty[]
}

model Property {
  id         Int             @id @default(autoincrement())
  slug       String          @unique
  address    String?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  // One-to-one relation (no fields/references defined here)
  facts      PropertyFacts?
  messages   Message[]
  bookings   Booking[]
  leads      LeadProperty[]
}

model PropertyFacts {
  id                 Int      @id @default(autoincrement())
  propertyId         Int      @unique
  slug               String   @unique
  address            String?
  buildingName       String?
  unitType           String?
  rent               String?
  deposit            String?
  leaseTerm          String?
  bedrooms           String?
  bathrooms          String?
  sqft               String?
  parking            String?
  parkingOptions     String?
  utilities          String?
  utilitiesIncluded  String?
  petsAllowed        Boolean?
  petPolicy          String?
  furnished          Boolean?
  availability       String?
  notes              String?
  floorPlans         Json?
  amenities          Json?
  managedBy          String?
  listingUrl         String?
  floorPlans         Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  property           Property @relation(fields: [propertyId], references: [id])
}






model Message {
  id         Int        @id @default(autoincrement())
  role       String
  content    String
  createdAt  DateTime   @default(now())

  leadId     Int
  propertyId Int?
  lead       Lead       @relation(fields: [leadId], references: [id])
  property   Property?  @relation(fields: [propertyId], references: [id])
}

model Booking {
  id          Int        @id @default(autoincrement())
  datetime    DateTime
  source      String?
  createdAt   DateTime   @default(now())

  leadId      Int
  propertyId  Int?
  lead        Lead       @relation(fields: [leadId], references: [id])
  property    Property?  @relation(fields: [propertyId], references: [id])
}

model LeadProperty {
  leadId      Int
  propertyId  Int

  lead        Lead       @relation(fields: [leadId], references: [id])
  property    Property   @relation(fields: [propertyId], references: [id])

  @@id([leadId, propertyId])
}
